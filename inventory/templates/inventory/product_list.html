{% extends 'inventory/base.html' %}

{% block content %}
<div class="mb-6 flex flex-col md:flex-row justify-between items-center bg-white p-4 rounded-lg shadow">
    <h1 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">Inventory Status</h1>
    
    <form method="get" class="flex w-full md:w-auto">
        <input type="text" name="q" value="{{ request.GET.q|default:'' }}" 
               placeholder="Search name or SKU..." 
               class="appearance-none border rounded-l w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        <button type="submit" class="bg-teal-500 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-r focus:outline-none focus:shadow-outline">
            Search
        </button>
        {% if request.GET.q %}
            <a href="{% url 'product_list' %}" class="ml-2 bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded flex items-center">Clear</a>
        {% endif %}
    </form>
</div>

<div class="overflow-x-auto bg-white rounded-lg shadow overflow-y-auto relative mb-4">
    <table class="border-collapse table-auto w-full whitespace-no-wrap bg-white table-striped relative">
        <thead>
            <tr class="text-left">
                <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Product</th>
                <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">SKU</th>
                <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Stock</th>
                <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Status</th>
                <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td class="border-dashed border-t border-gray-200 px-6 py-3">{{ product.name }}</td>
                <td class="border-dashed border-t border-gray-200 px-6 py-3">{{ product.sku }}</td>
                <td class="border-dashed border-t border-gray-200 px-6 py-3">{{ product.current_stock }}</td>
                <td class="border-dashed border-t border-gray-200 px-6 py-3">
                    {% if product.status_alert == 'critical' %}
                        <span class="text-white bg-red-600 px-2 py-1 rounded font-bold text-xs uppercase">Restock ASAP ({{ product.days_left }} days)</span>
                    {% elif product.status_alert == 'low' %}
                        <span class="text-orange-500 font-bold">Low Level</span>
                    {% else %}
                        <span class="text-green-500 font-bold">OK</span>
                    {% endif %}
                </td>
                <td class="border-dashed border-t border-gray-200 px-6 py-3">
                    <a href="{% url 'product_detail' product.pk %}" class="text-teal-600 hover:text-teal-800 font-bold">Details</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
<div class="flex flex-col md:flex-row justify-between items-center bg-white p-4 rounded-lg shadow mb-4">
    <div class="text-sm text-gray-600 mb-2 md:mb-0">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </div>
    
    <div class="inline-flex">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-l">
                &laquo; First
            </a>
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 border-l border-gray-300">
                Prev
            </a>
        {% else %}
            <span class="bg-gray-100 text-gray-400 font-bold py-2 px-4 rounded-l cursor-not-allowed">&laquo; First</span>
            <span class="bg-gray-100 text-gray-400 font-bold py-2 px-4 border-l border-gray-300 cursor-not-allowed">Prev</span>
        {% endif %}

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 border-l border-gray-300">
                Next
            </a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-r border-l border-gray-300">
                Last &raquo;
            </a>
        {% else %}
            <span class="bg-gray-100 text-gray-400 font-bold py-2 px-4 border-l border-gray-300 cursor-not-allowed">Next</span>
            <span class="bg-gray-100 text-gray-400 font-bold py-2 px-4 rounded-r border-l border-gray-300 cursor-not-allowed">Last &raquo;</span>
        {% endif %}
    </div>
</div>
{% endif %}

<div class="mt-4">
    <a href="{% url 'product_create' %}" class="bg-teal-500 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded">
        Add New Product
    </a>
</div>
{% endblock %}
